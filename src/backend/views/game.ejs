<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>UNO Lobby</title>  
        <link rel="stylesheet" href="/stylesheets/game.css">
    </head>
    <body data-game-id="<%= gameId %>">

        <div class="table">


            <% if (positions.top) { %>
                <div class="player player-top">
                <% for (let i = 0; i < positions.top.cards_in_hand; i++) { %>
                    <img src="/images/cards/Deck.png" class="top-player-card">
                <% } %>
                <h2 class="player-name"><%= positions.top.username %></h2>
                <h4 class="card-count">Card Count: <%= positions.top.cards_in_hand %></h4>
                </div>
            <% } %>


            <% if (positions.left) { %>
                <div class="player player-left">
                <h2 class="player-name"><%= positions.left.username %></h2>
                <h4 class="card-count">Card Count: <%= positions.left.cards_in_hand %></h4>
                <% for (let i = 0; i < positions.left.cards_in_hand; i++) { %>
                    <img src="/images/cards/Deck.png" class="left-player-card">
                <% } %>
                </div>
            <% } %>

            <div class="center-box">
                <div class="draw-card">
                    <h4 class="draw-text">Draw Card</h4>
                    <a class="draw" >
                        <img src="/images/cards/Deck.png" class="card card-1" id="draw-pile">
                    </a>
                </div>


                <% if (topDiscard) { %>
                    <img src="/images/cards/<%= topDiscard.color.charAt(0).toUpperCase() + topDiscard.color.slice(1) %>_<%= topDiscard.value %>.png" 
                         class="card card-2"
                    />
                <% } else { %>
                     <img  src="/images/cards/Deck.png"
                           class="card card-2"
                    />
                <% } %>

            </div>


            <% if (positions.right) { %>
                <div class="player player-right">
                <h2 class="player-name"><%= positions.right.username %></h2>
                <h4 class="card-count">Card Count: <%= positions.right.cards_in_hand %></h4>
                <% for (let i = 0; i < positions.right.cards_in_hand; i++) { %>
                <img src="/images/cards/Deck.png" class="right-player-card">
                <% } %>
                </div>
             <% } %>

            <div class="player player-bottom">

                <h2 class = "player-name"> <%= me.username %></h2>
                <h4 class="card-count">Card Count: <%= myCards.length %></h4>

                <% myCards.forEach(card => { %>
                    <img src="/images/cards/<%= card.color.charAt(0).toUpperCase() + card.color.slice(1) %>_<%= card.value %>.png"
                         class="bottom-player-card"
                         data-card-id = "<%= card.id %>"
                    />
                <% }) %>

            </div>
        </div>

        <!-- CHAT BOX -->
        <button id="chat-button">
            <img src="/images/assets/chat_image.png" class="chat-toggle">
        </button>
        <aside class="chat-section" data-room-type="game" data-game-room-id="<%= gameId %>">
        <div class="chat-header">Game Chat</div>

        <div class="chat-messages" id="chat-messages"></div>

        <form class="chat-input" id="chat-form">
          <input
            type="text"
            name="message"
            id="chat-input-field"
            placeholder="Type a message..."
            autocomplete="off"
          />
          <button type="submit" class="-message">Send</button>
        </form>
      </aside>

      <script>
        // Chat UI toggle functionality
        const chatButton = document.getElementById('chat-button');
        const chatSection = document.querySelector('.chat-section');

        // Toggle chat on button click
        chatButton.addEventListener('click', (e) => {
            chatSection.classList.toggle('open');
        });

        // Close when clicking outside chat AND outside button
        document.addEventListener('click', (e) => {
            const clickedInsideChat = chatSection.contains(e.target);
            const clickedChatButton = chatButton.contains(e.target);

            if (!clickedInsideChat && !clickedChatButton) {
                chatSection.classList.remove('open');
            }
        });

        // Close on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                chatSection.classList.remove('open');
            }
        });
      </script>



      <script src="/js/bundle.js"></script>
    
    </body>
</html>